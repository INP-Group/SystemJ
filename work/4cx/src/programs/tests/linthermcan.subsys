
     define(`forloop',
            `pushdef(`$1', `$2')_forloop(`$1', `$2', `$3', `$4')popdef(`$1')')
     define(`_forloop',
            `$4`'ifelse($1, `$3', ,
                   `define(`$1', incr($1))_forloop(`$1', `$2', `$3', `$4')')')

#---------------------------------------------------------------------

sysname linthermcan
defserver v2cx::linthermcan.ThermosM
wintitle main "Система термостабилизации - CAN"

define(`THERMLINE',
       `disp in$1  $2     text ""        "╟C" "%5.2f" in$1  disprange:+20-+40
        knob set$1 $2_set text "nounits" "╟C" "%5.2f" set$1 disprange:+20-+40
        disp out$1 $2_out text ""        "╟C" "%5.2f" out$1 disprange:+20-+40 \
                normrange:-1-+1 yelwrange:-2-+2 \
                c:"_all_code; getchan out$1; getchan set$1; sub; ret"
        ')

define(`AVGCELL',
       `disp $1    $2 text     ""        "╟C" "%5.2f" r:"_all_code
                push 0;
                forloop(`N', 0, 18, `getchan $3`'N; add;')
                div 19; ret'" disprange:+20-+40)

grouping main LINTHERMCAN_grouping "Термостабилизация" grid \
        str3:"Вход\tЗадано, ╟C\tВыход\tРасход\tМощн." \
        param1:3 param3:2 content:eval(2+3*19+3) {

    disp -limit "Tвход_max" text ""        "╟C" "%5.2f" -limit \
        tip:"При передудонивании Tвход_cредн>Tвход_max бокр штеко трямкает"
    container -setlim "..." subwin str3:"Tвход_max" content:1 {
        knob -limit "Tвход_max" text "withlabel" "╟C" "%5.2f" -setlim.-limit \
                alwdrange:25-40
    }

    THERMLINE( 0, "ГРУП_П")
    THERMLINE( 1, "SLED_1")
    THERMLINE( 4, "SLED_2")
    THERMLINE(13, "")
    THERMLINE(17, "SLED_4")
    THERMLINE( 2, "SEC_01")
    THERMLINE( 3, "SEC_02")
    THERMLINE( 5, "SEC_03")
    THERMLINE( 6, "SEC_04")
    THERMLINE( 7, "SEC_05")
    THERMLINE( 8, "SEC_06")
    THERMLINE( 9, "SEC_07")
    THERMLINE(10, "SEC_08")
    THERMLINE(11, "SEC_09")
    THERMLINE(12, "SEC_10")
    THERMLINE(14, "SEC_11")
    THERMLINE(15, "SEC_12")
    THERMLINE(16, "SEC_13")
    THERMLINE(18, "SEC_14")
    AVGCELL(inA,  AVG,    in)
    AVGCELL(setA, setAVG, set)
    AVGCELL(outA, outAVG, out)
}
