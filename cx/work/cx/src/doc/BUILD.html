<HTML>
<HEAD>
<TITLE>Система сборки CX</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="style.css">
</HEAD>
<BODY>

<H1>Система сборки CX</H1>


<H2>Введение</H2>


<H2>Использование <TT>make</TT></H2>

<P>Прилагающиеся Makefile'ы поддерживают сборку как содержимого дерева
<TT>cx/</TT>, так и стороннего кода (прикладных программ, драйверов и
т.д.).  Makefile'ы автоматически определяют окружение (тип ОС и
процессора, версия компилятора gcc) и выполняют соответствующие
настройки.  Кроме того, в Makefile'ах выполняется автоматическая
перегенерация файлов зависимостей при изменении исходных файлов (так
что не требуется операция вида "make depend"; описание идеи см. в "info
'make automatic prerequisites'").

<P>Для сборки требуется программа GNU `make' (впрочем, в Linux
единственным `make' является именно GNU `make'), причем, вследствие
используемых фич (а именно -- конструкции "$(if...)" и target-specific
variables), версии не ниже 3.78.  В качестве C-компилятора используется
gcc.

<P>Можно запускать <CODE>make</CODE> как в директории <TT>src/</TT> --
при этом будет собрана вся система, так и в любой из поддиректорий --
при этом произведется сборка этой директории и ее поддиректорий.

<P>По умолчанию целью (goal) является "<CODE>firsttarget</CODE>", он же
"<CODE>all</CODE>", осуществляющий сборку содержимого директории. 
Кроме того, поддерживаются следующие цели:

<DL>

<DT><CODE>files</CODE> <DD>осуществить сборку только файлов в этой
директории, пропустив поддиректории.

<DT><CODE>subdirs</CODE> <DD>осуществить сборку только в поддиректориях
(если таковые имеются), пропустив файлы.

<DT><CODE>clean</CODE> <DD>удаление результатов компилиции и сборки --
объектных и исполняемых файлов.

<DT><CODE>distclean</CODE> <DD><CODE>clean</CODE> плюс удаление
backup-файлов и "рабочих" файлов (<TT>*.log</TT>, <TT>*.pid</TT>).

<DT><CODE>maintainer-clean</CODE> <DD><CODE>distclean</CODE> плюс
удаление файлов зависимостей (<TT>*.d</TT>) и прочих генерируемых
файлов.

<DT><CODE>flags</CODE> <DD>печать значений служебных флагов -- тип
процессора, тип ОС и т.д.

</DL>

<P>Перед "перетряхиванием" include-файлов, включающем удаление
некоторых из них, следует выполнить "<CODE>make
maintainer-clean</CODE>", чтобы ссылки на них были удалены из файлов
зависимостей.  В противном случае придется удалять .d-файлы вручную.

Следующие цели поддерживаются только при сборке содержимого cx/:

<DL>

<DT><CODE>exports</CODE> <DD>подготовка к инсталлиции -- складирование
готовых файлов в директорию <CODE>exports/</CODE>; автоматически
вызывает <CODE>all</CODE>.

<DT><CODE>install</CODE> <DD>инсталляция системы; автоматически
вызывает <CODE>exports</CODE>. Эта цель имеет смысл только в директории
<TT>src/</TT>.

</DL>

<P>При вызове make для компиляции/сборки можно включить дополнительные
("параноидальные") предупреждения компилятора.  Это делается указанием
в командной строке make фразы "<CODE>AUXWARNS=all</CODE>"; например,
"<CODE>make AUXWARNS=all</CODE>".


<H2>Структура директорий</H2>

<P>Основная директория (для краткости будем называть ее <TT>cx/</TT>)
содержит четыре поддиректории:

<DL>

<DT><TT>src</TT> <DD>собственно исходные коды системы; в этой же
директории производится сборка.

<DT><TT>exports</TT> <DD>сюда складываются готовые к инсталляции файлы
(см. "make exports").

<DT><TT>tools</TT> <DD>дополнительные программы, требующиеся для сборки
(в т.ч. кросс-компиляторы для "подчиненных" платформ).

<DT><TT>3-rd-party</TT> <DD>полные дистрибутивы пакетов/компонентов,
использующихся в CX в виде исходных кодов.

</DL>


<H2>Структура <TT>src/</TT></H2>

<P>За основу при разработке структуры директории <TT>src/</TT> брались принципы,
использующиеся в исходниках X11 (директория xc/):

<DL>

<DT><TT>include</TT> <DD>публичные, а также общие для двух и более
компонентов системы include-файлы.

<DT><TT>lib</TT> <DD>библиотеки:

  <DL>

  <DT><TT>cxlib</TT> <DD><A HREF="lib/cxlib.html">CX
LIBrary</A>&nbsp;-- клиентская библиотека для доступа к cx-серверу.

  <DT><TT>cda</TT> <DD><A HREF="lib/cda.html">Cx Data
Access</A>&nbsp;-- клиентская библиотека для доступа к "высокоуровневым
данным".

  <DT><TT>Knobs</TT> <DD><A HREF="lib/Knobs.html">control Knobs
library</A>&nbsp;-- библиотека управляющих элементов.

  <DT><TT>Cdr</TT> <DD>Cx Data Representation library -- библиотека,
отвечающая за "представление данных": она  обеспечивает конверсию
описаний каналов/<WBR>элементов/<WBR>группировок в формат, пригодный к
использованию с Knobs, и манипуляции с ним.

  <DT><TT>Chl</TT> <DD>Cx High-Level library -- библиотека для создания
графических клиентов.

  <DT><TT>Xh</TT> <DD>библиотека для создания окошек.

  <DT><TT>useful</TT> <DD>"общеполезные" библиотеки, в принципе могущие
использоваться и вне CX.

  </DL>

<DT><TT>programs</TT> <DD>разные программы, включая собственно сервер:

  <DL>

  <DT><TT>chlclients</TT> <DD>графические клиенты на основе библиотеки Chl

  <DT><TT>server</TT> <DD>собственно cx-сервер, драйверы к нему.

  <DT><TT>utils</TT> <DD>утилиты, такие, как cx-rdt, cx-console.

  <DT><TT>xutils</TT> <DD>утилиты с графическим интерфейсом

  <DT><TT>xmclients</TT> <DD>графические клиенты

  </DL>

<DT><TT>scripts</TT> <DD>скрипты, использующиеся из Makefile'ов в
процессе сборки или инсталляции.

<DT><TT>doc</TT> <DD>документация.

</DL>


<H2>Раскладка инсталлированной системы по директориям</H2>


<H2>Компиляция стороннего кода</H2>

<P>Система сборки позволяет компилировать "сторонний" код, т.е., не
принадлежащий к стандартному дереву -- например, дополнительные
драйверы, клиентские программы и т.д.

<P>При этом <TT>Makefile</TT> в такой "внешней" директории обычно имеет
следующий вид:

<BLOCKQUOTE><PRE>
???????????
TOPDIR=&lt;PATH-TO-cx/src&gt;
include $(TOPDIR>/&lt;SUBDIR&gt;/LocalRules.mk
</PRE></BLOCKQUOTE>

<P>Поскольку для разных поддиректорий содержимое <TT>Makefile</TT>
отличается, а главное -- оно со временем может меняться, то лучше всего
заглядывать в начало соответствующего <TT>LocalRules.mk</TT>, где
всегда имеется наиболее современная документация на этот счет.

<P>В настоящий момент (28.06.2004) возможность компиляции стороннего
кода предоставляют следующие директории:

<BLOCKQUOTE><PRE>
programs/chlclients/
programs/xmclients/
programs/server/drivers/
programs/server/drivers/cm5307/ppc_drvlets/
programs/server/drivers/cm5307/uclinux_drvlets/
</PRE></BLOCKQUOTE>



<H2>Многоплатформность</H2>


</BODY>
</HTML>
